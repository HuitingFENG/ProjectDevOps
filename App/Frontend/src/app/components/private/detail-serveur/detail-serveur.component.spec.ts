import { ComponentFixture, TestBed } from '@angular/core/testing';

import { DetailServeurComponent } from './detail-serveur.component';

import {RouterTestingModule} from "@angular/router/testing";
import { AbonnementManagerService } from "../../../services/abonnementManager/abonnement-manager.service";
import { MockServerMonitoringService } from "../../../services/mock-server-monitoring/mock-server-monitoring.service";
import {HttpClientTestingModule} from "@angular/common/http/testing";
import {BsModalService} from "ngx-bootstrap/modal";
import {of} from "rxjs";
import {ActivatedRoute} from "@angular/router";

describe('DetailServeurComponent', () => {
  let component: DetailServeurComponent;
  let fixture: ComponentFixture<DetailServeurComponent>;

  let localStore: { [x: string]: any; };

  // Define default return values
  let mockAbonnementManagerService = jasmine.createSpyObj(['getAbonnement', 'deleteAbonnement']);
  mockAbonnementManagerService.getAbonnement.and.returnValue(of({
    "id": 2,"id_client": 1,"date_debut": new Date("2021-09-01T00:00:00.000Z"),"date_fin": null,"vcores": 16,"ram": "32 Go","disque": "500 Go","bande_passante": 1000,"os": "Debian 10","prix": 6800
  }))
  let mockMockServerMonitoringService = jasmine.createSpyObj(['constructLabels', 'constructData']);
  mockMockServerMonitoringService.constructLabels.withArgs(24).and.returnValue([new Date("09/05/2022, 10:00:00"),new Date("09/05/2022, 10:05:00"),new Date("09/05/2022, 10:10:00"),new Date("09/05/2022, 10:15:00"),new Date("09/05/2022, 10:20:00"),new Date("09/05/2022, 10:25:00"),new Date("09/05/2022, 10:30:00"),new Date("09/05/2022, 10:35:00"),new Date("09/05/2022, 10:40:00"),new Date("09/05/2022, 10:45:00"),new Date("09/05/2022, 10:50:00"),new Date("09/05/2022, 10:55:00"),new Date("09/05/2022, 11:00:00"),new Date("09/05/2022, 11:05:00"),new Date("09/05/2022, 11:10:00"),new Date("09/05/2022, 11:15:00"),new Date("09/05/2022, 11:20:00"),new Date("09/05/2022, 11:25:00"),new Date("09/05/2022, 11:30:00"),new Date("09/05/2022, 11:35:00"),new Date("09/05/2022, 11:40:00"),new Date("09/05/2022, 11:45:00"),new Date("09/05/2022, 11:50:00"),new Date("09/05/2022, 11:55:00"),new Date("09/05/2022, 12:00:00"),new Date("09/05/2022, 12:05:00"),new Date("09/05/2022, 12:10:00"),new Date("09/05/2022, 12:15:00"),new Date("09/05/2022, 12:20:00"),new Date("09/05/2022, 12:25:00"),new Date("09/05/2022, 12:30:00"),new Date("09/05/2022, 12:35:00"),new Date("09/05/2022, 12:40:00"),new Date("09/05/2022, 12:45:00"),new Date("09/05/2022, 12:50:00"),new Date("09/05/2022, 12:55:00"),new Date("09/05/2022, 13:00:00"),new Date("09/05/2022, 13:05:00"),new Date("09/05/2022, 13:10:00"),new Date("09/05/2022, 13:15:00"),new Date("09/05/2022, 13:20:00"),new Date("09/05/2022, 13:25:00"),new Date("09/05/2022, 13:30:00"),new Date("09/05/2022, 13:35:00"),new Date("09/05/2022, 13:40:00"),new Date("09/05/2022, 13:45:00"),new Date("09/05/2022, 13:50:00"),new Date("09/05/2022, 13:55:00"),new Date("09/05/2022, 14:00:00"),new Date("09/05/2022, 14:05:00"),new Date("09/05/2022, 14:10:00"),new Date("09/05/2022, 14:15:00"),new Date("09/05/2022, 14:20:00"),new Date("09/05/2022, 14:25:00"),new Date("09/05/2022, 14:30:00"),new Date("09/05/2022, 14:35:00"),new Date("09/05/2022, 14:40:00"),new Date("09/05/2022, 14:45:00"),new Date("09/05/2022, 14:50:00"),new Date("09/05/2022, 14:55:00"),new Date("09/05/2022, 15:00:00"),new Date("09/05/2022, 15:05:00"),new Date("09/05/2022, 15:10:00"),new Date("09/05/2022, 15:15:00"),new Date("09/05/2022, 15:20:00"),new Date("09/05/2022, 15:25:00"),new Date("09/05/2022, 15:30:00"),new Date("09/05/2022, 15:35:00"),new Date("09/05/2022, 15:40:00"),new Date("09/05/2022, 15:45:00"),new Date("09/05/2022, 15:50:00"),new Date("09/05/2022, 15:55:00"),new Date("09/05/2022, 16:00:00"),new Date("09/05/2022, 16:05:00"),new Date("09/05/2022, 16:10:00"),new Date("09/05/2022, 16:15:00"),new Date("09/05/2022, 16:20:00"),new Date("09/05/2022, 16:25:00"),new Date("09/05/2022, 16:30:00"),new Date("09/05/2022, 16:35:00"),new Date("09/05/2022, 16:40:00"),new Date("09/05/2022, 16:45:00"),new Date("09/05/2022, 16:50:00"),new Date("09/05/2022, 16:55:00"),new Date("09/05/2022, 17:00:00"),new Date("09/05/2022, 17:05:00"),new Date("09/05/2022, 17:10:00"),new Date("09/05/2022, 17:15:00"),new Date("09/05/2022, 17:20:00"),new Date("09/05/2022, 17:25:00"),new Date("09/05/2022, 17:30:00"),new Date("09/05/2022, 17:35:00"),new Date("09/05/2022, 17:40:00"),new Date("09/05/2022, 17:45:00"),new Date("09/05/2022, 17:50:00"),new Date("09/05/2022, 17:55:00"),new Date("09/05/2022, 18:00:00"),new Date("09/05/2022, 18:05:00"),new Date("09/05/2022, 18:10:00"),new Date("09/05/2022, 18:15:00"),new Date("09/05/2022, 18:20:00"),new Date("09/05/2022, 18:25:00"),new Date("09/05/2022, 18:30:00"),new Date("09/05/2022, 18:35:00"),new Date("09/05/2022, 18:40:00"),new Date("09/05/2022, 18:45:00"),new Date("09/05/2022, 18:50:00"),new Date("09/05/2022, 18:55:00"),new Date("09/05/2022, 19:00:00"),new Date("09/05/2022, 19:05:00"),new Date("09/05/2022, 19:10:00"),new Date("09/05/2022, 19:15:00"),new Date("09/05/2022, 19:20:00"),new Date("09/05/2022, 19:25:00"),new Date("09/05/2022, 19:30:00"),new Date("09/05/2022, 19:35:00"),new Date("09/05/2022, 19:40:00"),new Date("09/05/2022, 19:45:00"),new Date("09/05/2022, 19:50:00"),new Date("09/05/2022, 19:55:00"),new Date("09/05/2022, 20:00:00"),new Date("09/05/2022, 20:05:00"),new Date("09/05/2022, 20:10:00"),new Date("09/05/2022, 20:15:00"),new Date("09/05/2022, 20:20:00"),new Date("09/05/2022, 20:25:00"),new Date("09/05/2022, 20:30:00"),new Date("09/05/2022, 20:35:00"),new Date("09/05/2022, 20:40:00"),new Date("09/05/2022, 20:45:00"),new Date("09/05/2022, 20:50:00"),new Date("09/05/2022, 20:55:00"),new Date("09/05/2022, 21:00:00"),new Date("09/05/2022, 21:05:00"),new Date("09/05/2022, 21:10:00"),new Date("09/05/2022, 21:15:00"),new Date("09/05/2022, 21:20:00"),new Date("09/05/2022, 21:25:00"),new Date("09/05/2022, 21:30:00"),new Date("09/05/2022, 21:35:00"),new Date("09/05/2022, 21:40:00"),new Date("09/05/2022, 21:45:00"),new Date("09/05/2022, 21:50:00"),new Date("09/05/2022, 21:55:00"),new Date("09/05/2022, 22:00:00"),new Date("09/05/2022, 22:05:00"),new Date("09/05/2022, 22:10:00"),new Date("09/05/2022, 22:15:00"),new Date("09/05/2022, 22:20:00"),new Date("09/05/2022, 22:25:00"),new Date("09/05/2022, 22:30:00"),new Date("09/05/2022, 22:35:00"),new Date("09/05/2022, 22:40:00"),new Date("09/05/2022, 22:45:00"),new Date("09/05/2022, 22:50:00"),new Date("09/05/2022, 22:55:00"),new Date("09/05/2022, 23:00:00"),new Date("09/05/2022, 23:05:00"),new Date("09/05/2022, 23:10:00"),new Date("09/05/2022, 23:15:00"),new Date("09/05/2022, 23:20:00"),new Date("09/05/2022, 23:25:00"),new Date("09/05/2022, 23:30:00"),new Date("09/05/2022, 23:35:00"),new Date("09/05/2022, 23:40:00"),new Date("09/05/2022, 23:45:00"),new Date("09/05/2022, 23:50:00"),new Date("09/05/2022, 23:55:00"),new Date("10/05/2022, 00:00:00"),new Date("10/05/2022, 00:05:00"),new Date("10/05/2022, 00:10:00"),new Date("10/05/2022, 00:15:00"),new Date("10/05/2022, 00:20:00"),new Date("10/05/2022, 00:25:00"),new Date("10/05/2022, 00:30:00"),new Date("10/05/2022, 00:35:00"),new Date("10/05/2022, 00:40:00"),new Date("10/05/2022, 00:45:00"),new Date("10/05/2022, 00:50:00"),new Date("10/05/2022, 00:55:00"),new Date("10/05/2022, 01:00:00"),new Date("10/05/2022, 01:05:00"),new Date("10/05/2022, 01:10:00"),new Date("10/05/2022, 01:15:00"),new Date("10/05/2022, 01:20:00"),new Date("10/05/2022, 01:25:00"),new Date("10/05/2022, 01:30:00"),new Date("10/05/2022, 01:35:00"),new Date("10/05/2022, 01:40:00"),new Date("10/05/2022, 01:45:00"),new Date("10/05/2022, 01:50:00"),new Date("10/05/2022, 01:55:00"),new Date("10/05/2022, 02:00:00"),new Date("10/05/2022, 02:05:00"),new Date("10/05/2022, 02:10:00"),new Date("10/05/2022, 02:15:00"),new Date("10/05/2022, 02:20:00"),new Date("10/05/2022, 02:25:00"),new Date("10/05/2022, 02:30:00"),new Date("10/05/2022, 02:35:00"),new Date("10/05/2022, 02:40:00"),new Date("10/05/2022, 02:45:00"),new Date("10/05/2022, 02:50:00"),new Date("10/05/2022, 02:55:00"),new Date("10/05/2022, 03:00:00"),new Date("10/05/2022, 03:05:00"),new Date("10/05/2022, 03:10:00"),new Date("10/05/2022, 03:15:00"),new Date("10/05/2022, 03:20:00"),new Date("10/05/2022, 03:25:00"),new Date("10/05/2022, 03:30:00"),new Date("10/05/2022, 03:35:00"),new Date("10/05/2022, 03:40:00"),new Date("10/05/2022, 03:45:00"),new Date("10/05/2022, 03:50:00"),new Date("10/05/2022, 03:55:00"),new Date("10/05/2022, 04:00:00"),new Date("10/05/2022, 04:05:00"),new Date("10/05/2022, 04:10:00"),new Date("10/05/2022, 04:15:00"),new Date("10/05/2022, 04:20:00"),new Date("10/05/2022, 04:25:00"),new Date("10/05/2022, 04:30:00"),new Date("10/05/2022, 04:35:00"),new Date("10/05/2022, 04:40:00"),new Date("10/05/2022, 04:45:00"),new Date("10/05/2022, 04:50:00"),new Date("10/05/2022, 04:55:00"),new Date("10/05/2022, 05:00:00"),new Date("10/05/2022, 05:05:00"),new Date("10/05/2022, 05:10:00"),new Date("10/05/2022, 05:15:00"),new Date("10/05/2022, 05:20:00"),new Date("10/05/2022, 05:25:00"),new Date("10/05/2022, 05:30:00"),new Date("10/05/2022, 05:35:00"),new Date("10/05/2022, 05:40:00"),new Date("10/05/2022, 05:45:00"),new Date("10/05/2022, 05:50:00"),new Date("10/05/2022, 05:55:00"),new Date("10/05/2022, 06:00:00"),new Date("10/05/2022, 06:05:00"),new Date("10/05/2022, 06:10:00"),new Date("10/05/2022, 06:15:00"),new Date("10/05/2022, 06:20:00"),new Date("10/05/2022, 06:25:00"),new Date("10/05/2022, 06:30:00"),new Date("10/05/2022, 06:35:00"),new Date("10/05/2022, 06:40:00"),new Date("10/05/2022, 06:45:00"),new Date("10/05/2022, 06:50:00"),new Date("10/05/2022, 06:55:00"),new Date("10/05/2022, 07:00:00"),new Date("10/05/2022, 07:05:00"),new Date("10/05/2022, 07:10:00"),new Date("10/05/2022, 07:15:00"),new Date("10/05/2022, 07:20:00"),new Date("10/05/2022, 07:25:00"),new Date("10/05/2022, 07:30:00"),new Date("10/05/2022, 07:35:00"),new Date("10/05/2022, 07:40:00"),new Date("10/05/2022, 07:45:00"),new Date("10/05/2022, 07:50:00"),new Date("10/05/2022, 07:55:00"),new Date("10/05/2022, 08:00:00"),new Date("10/05/2022, 08:05:00"),new Date("10/05/2022, 08:10:00"),new Date("10/05/2022, 08:15:00"),new Date("10/05/2022, 08:20:00"),new Date("10/05/2022, 08:25:00"),new Date("10/05/2022, 08:30:00"),new Date("10/05/2022, 08:35:00"),new Date("10/05/2022, 08:40:00"),new Date("10/05/2022, 08:45:00"),new Date("10/05/2022, 08:50:00"),new Date("10/05/2022, 08:55:00"),new Date("10/05/2022, 09:00:00"),new Date("10/05/2022, 09:05:00"),new Date("10/05/2022, 09:10:00"),new Date("10/05/2022, 09:15:00"),new Date("10/05/2022, 09:20:00"),new Date("10/05/2022, 09:25:00"),new Date("10/05/2022, 09:30:00"),new Date("10/05/2022, 09:35:00"),new Date("10/05/2022, 09:40:00"),new Date("10/05/2022, 09:45:00"),new Date("10/05/2022, 09:50:00"),new Date("10/05/2022, 09:55:00"),new Date("10/05/2022, 10:00:00"),new Date("10/05/2022, 10:05:00"),new Date("10/05/2022, 10:10:00"),new Date("10/05/2022, 10:15:00")])
  mockMockServerMonitoringService.constructData.withArgs(292, "Utilisation CPU").and.returnValue({
    "data": [
      26.27,21.71,18.11,15.67,15.45,11.25,11.04,13.86,13.84,18.33,15.27,12.22,9.14,4.38,4,5.84,5.58,4,7.49,11.6,14.17,14.83,13.48,11.95,8.43,6.16,4.48,9.08,5.47,4,4,6.26,4.15,4,4,6.16,4.43,4,8.11,11.75,15.95,18.39,16.69,14.09,12.92,9.92,8.31,4.05,4.84,4,6.59,11.39,7.51,4.29,5.65,6.96,6.17,8.16,7.45,10.87,6.75,4.71,4,4,5.21,4,4,5.04,6.63,5.52,9.21,10.56,8.97,11.03,11.19,14.06,16.22,20.19,23.97,19.9,22.36,18.23,13.77,9.28,9.81,12.81,15.38,16.35,12.76,17.03,19.62,24.28,26.29,25.1,28.4,29.56,30.88,27.13,26.85,23.89,27.21,27.38,29.43,26.25,28.03,28.55,24.32,22.46,24.79,29.77,32.28,30.03,32.24,30.93,29.32,27.61,23.16,24.21,21.99,22.39,26.34,29.03,33.87,31.78,35.98,31.03,31.66,35.75,40.68,37.13,38.46,42.98,47.18,46.55,43.13,44.64,47.47,45.67,45,48.91,44.17,47.19,44.83,45.34,47.72,47.4,50.25,45.91,48.47,48.67,44.48,46.2,43.59,46.64,50.8,48.74,44.22,43.86,41.28,38.46,34.3,36.46,37.01,34.99,38.19,39.58,44.37,45.06,49.38,44.47,49.18,50.82,55.37,55.56,52.41,53.63,55.93,57.21,60.54,59.41,59.59,60.63,63.51,64.18,64.45,63.13,66.25,69.71,69.68,65.59,66.31,70.49,67.9,72.68,76.52,77.46,78.6,73.98,72.7,74.66,73.9,77.41,75.01,73.93,69.25,72.13,72.58,75.07,74.52,71.72,74.1,75.99,76.49,73.05,76.54,72.17,68.4,65.59,64.87,69.38,65.44,65.78,69.33,68.78,68.86,69.16,73.27,76.1,77.8,74.79,70.42,71.26,71.51,73.4,73.51,72.99,71.49,70.05,67.67,69.03,66.58,69.24,65.51,60.82,59.22,59.83,59.73,58.24,59,62.07,62,58.91,60.33,59.73,56.99,54.32,50.41,46.02,43.4,44.04,40.85,37.57,35.42,39.28,44.04,42.91,45.67,48.31,44.6,42.55,43.83,42.08,46.62,45.99,50.18,49.43,49.81,44.88,49.66,45.02,49.95,52.79,54.11,57.56,55.94,54.48,57.79,56.52,51.64,54.58,55.15,59.32,57.32,59.35
    ],
    "label": "Utilisation CPU"
  })
  mockMockServerMonitoringService.constructData.withArgs(292, "Utilisation RAM").and.returnValue({
    "data": [
      40.79,38.95,41.6,45.49,41.52,37.09,32.3,35.85,36.88,41.39,37.35,41.16,41.11,37.05,39,38.18,36.72,34.36,36.74,39.05,38.61,43.14,47.96,46.88,42.73,39.28,39.59,38.59,34.21,36.04,40.45,39.25,40.37,36.46,37.87,42.7,42.41,45.27,41.18,40.34,37.7,34.79,37.23,32.56,32.99,30.66,31.64,36.04,31.29,35.27,32.43,35.38,36.72,39.16,37.93,41.75,41.96,38.33,39.34,34.38,35.95,38.26,35.97,39.04,36.71,39.83,44.57,45.39,48.88,46.85,46.66,50.13,48.52,50.17,53.33,53.75,54.98,55.84,57.5,54.93,56.08,57.74,53.03,51.28,49.72,47.03,44.45,41.23,37.27,37.84,40.7,36.34,39.28,43.13,45.87,43.29,39.66,40.69,39.36,42.15,45.12,48.53,45.76,42.25,40.26,36.68,36.34,39.65,36.95,38.41,41.33,39.09,43.42,44.2,44.49,39.92,38.94,41.89,42.32,46.89,42.71,40.03,37.59,39.85,39.27,40.39,36.7,32.36,33.49,32.1,31.42,35.06,34.65,32.63,28.58,30.39,27.12,29.49,27.13,27.28,30.7,32.87,34.94,31.94,33.27,32.9,37.79,36.6,34.44,34.34,31.45,29.76,33.03,29.32,28.65,32.01,32.46,32.15,31.06,30.55,26.58,29.5,31.06,27.3,29.75,34.34,33.56,35.83,34.4,36.16,38.75,43.25,42.28,39.79,44.64,46.08,43.06,42.79,40.76,44.86,49.46,50.28,52.03,52.96,54.99,57.45,56.22,59.47,62.5,64.99,60.08,58.09,58.48,57.18,61.61,58.6,60.77,55.95,51.35,48.6,45.77,43.87,41.86,41.46,45.84,40.96,38.43,37.76,37.09,36.08,35.79,39.13,40.66,43.64,44.16,46.07,48.57,49.12,48.83,48.86,47.49,44.11,46.46,42.34,38.85,35.81,39.51,43.96,48.37,43.74,42.2,46.76,46.39,46.65,44.11,45.11,45.72,47.85,45.38,41.47,41.42,45.18,41.46,41.64,44.64,43.54,47.89,46.45,49.98,47.6,48.15,49.49,48.88,52.93,48.4,44.81,43.88,46.81,44.88,43.91,39.21,43.99,41.87,38.41,34.64,38.87,36.49,36.7,41.01,43.1,47.1,49.96,49.71,47.78,43.18,45.86,43.64,42.47,44.65,47.94,45.87,41.49,40.59,40.32,40.82,40.1,40.68,45.46,46.37,42.66,41.68,39.13,42.04,41.89
    ],
    "label": "Utilisation RAM"
  })

  beforeEach(async () => {
    localStore = {
      "server2": "true",
      "server1": "false",
      "server3": "false"
    };
    spyOn(window.localStorage, 'getItem').and.callFake((key) =>
      key in localStore ? localStore[key] : null
    );
    spyOn(window.localStorage, 'setItem').and.callFake(
      (key, value) => (localStore[key] = value + '')
    );
    spyOn(window.localStorage, 'clear').and.callFake(() => (localStore = {}));

    await TestBed.configureTestingModule({
      providers: [
        { provide: AbonnementManagerService, useValue: mockAbonnementManagerService},
        { provide: MockServerMonitoringService, useValue: mockMockServerMonitoringService},
        BsModalService,
        {
          provide: ActivatedRoute,
          useValue: {
            snapshot: {params : {idServeur: 2}}
          }
        }
      ],
      imports: [
        HttpClientTestingModule,
        RouterTestingModule
      ],
      declarations: [ DetailServeurComponent ]
    })
    .compileComponents();
  });

  beforeEach(() => {
    fixture = TestBed.createComponent(DetailServeurComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});
